<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FOMO Elements - Kh√≥a 7 Ng√†y Khai M·ªü T·∫ßn S·ªë G·ªëc</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800;900&family=Noto+Sans+Display:wght@400;600;700&display=swap" rel="stylesheet">
<style>
/* Reset ƒë·ªÉ tr√°nh conflict */
.fomo-container * {
    box-sizing: border-box;
}

/* ============================================
   ELEMENT 1: FLOATING STICKY BAR (Top)
   ============================================ */
.fomo-sticky-countdown-bar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: linear-gradient(135deg, #9C0612 0%, #761E0B 100%);
    color: #FFFFFF;
    padding: 8px 15px;
    z-index: 9999;
    box-shadow: 0 2px 15px rgba(0,0,0,0.3);
    border-bottom: 2px solid #FFBD59;
    animation: fomo-slideDown 0.5s ease-out;
}

@keyframes fomo-slideDown {
    from { transform: translateY(-100%); }
    to { transform: translateY(0); }
}

.fomo-sticky-countdown-bar .fomo-content {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 15px;
}

.fomo-sticky-countdown-bar .fomo-message {
    font-family: 'Montserrat', sans-serif;
    font-size: 13px;
    font-weight: 700;
    color: #FFBD59;
    white-space: nowrap;
}

.fomo-sticky-countdown-bar .fomo-mini-countdown {
    display: flex;
    gap: 6px;
}

.fomo-sticky-countdown-bar .fomo-time-box {
    background: rgba(0,0,0,0.3);
    padding: 4px 8px;
    border-radius: 6px;
    border: 1px solid #FFBD59;
    min-width: 35px;
    text-align: center;
}

.fomo-sticky-countdown-bar .fomo-time-box .fomo-num {
    font-family: 'Montserrat', sans-serif;
    font-size: 16px;
    font-weight: 800;
    color: #FFBD59;
    display: block;
    line-height: 1;
}

.fomo-sticky-countdown-bar .fomo-time-box .fomo-label {
    font-family: 'Noto Sans Display', sans-serif;
    font-size: 9px;
    color: #DEBC81;
    display: block;
    line-height: 1;
    margin-top: 2px;
}

.fomo-sticky-countdown-bar .fomo-sticky-cta {
    background: #FFBD59;
    color: #112250;
    padding: 6px 18px;
    border-radius: 50px;
    font-family: 'Montserrat', sans-serif;
    font-weight: 700;
    text-decoration: none;
    font-size: 12px;
    transition: all 0.3s;
    border: 2px solid #FFBD59;
    white-space: nowrap;
}

.fomo-sticky-countdown-bar .fomo-sticky-cta:hover {
    background: transparent;
    color: #FFBD59;
    transform: scale(1.05);
}

/* ============================================
   ELEMENT 2: LIVE REGISTRATION TICKER
   ============================================ */
.fomo-live-ticker {
    position: fixed;
    bottom: 15px;
    left: 15px;
    background: rgba(17,34,80,0.95);
    backdrop-filter: blur(10px);
    color: #FFFFFF;
    padding: 10px 15px;
    border-radius: 12px;
    border: 2px solid #FFBD59;
    box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    z-index: 9998;
    max-width: 280px;
    opacity: 0;
    transform: translateX(-120%);
    transition: all 0.5s ease-out;
}

.fomo-live-ticker.fomo-show {
    opacity: 1;
    transform: translateX(0);
}

.fomo-live-ticker .fomo-ticker-icon {
    width: 35px;
    height: 35px;
    background: linear-gradient(135deg, #FFBD59, #DEBC81);
    border-radius: 50%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    margin-right: 10px;
    float: left;
    flex-shrink: 0;
}

.fomo-live-ticker .fomo-ticker-content {
    overflow: hidden;
}

.fomo-live-ticker .fomo-ticker-name {
    font-family: 'Montserrat', sans-serif;
    font-weight: 700;
    color: #FFBD59;
    font-size: 13px;
    line-height: 1.3;
}

.fomo-live-ticker .fomo-ticker-action {
    font-family: 'Noto Sans Display', sans-serif;
    font-size: 12px;
    color: #DEBC81;
    margin-top: 2px;
    line-height: 1.2;
}

.fomo-live-ticker .fomo-ticker-time {
    font-family: 'Noto Sans Display', sans-serif;
    font-size: 10px;
    color: rgba(222,188,129,0.7);
    margin-top: 3px;
}

/* ============================================
   ELEMENT 3: EXIT INTENT POPUP
   ============================================ */
.fomo-exit-popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.85);
    z-index: 99999;
    display: none;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease-out;
}

.fomo-exit-popup-overlay.fomo-show {
    display: flex;
    opacity: 1;
}

.fomo-exit-popup {
    background: linear-gradient(135deg, #112250 0%, #640A0C 100%);
    border: 3px solid #FFBD59;
    border-radius: 25px;
    padding: 50px 40px;
    max-width: 600px;
    width: 90%;
    text-align: center;
    position: relative;
    transform: scale(0.8);
    transition: transform 0.4s ease-out;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
}

.fomo-exit-popup-overlay.fomo-show .fomo-exit-popup {
    transform: scale(1);
}

.fomo-exit-popup .fomo-close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: transparent;
    border: none;
    color: #DEBC81;
    font-size: 30px;
    cursor: pointer;
    transition: all 0.3s;
    font-family: Arial, sans-serif;
}

.fomo-exit-popup .fomo-close-btn:hover {
    color: #FFBD59;
    transform: rotate(90deg);
}

.fomo-exit-popup .fomo-emoji {
    font-size: 80px;
    margin-bottom: 20px;
}

.fomo-exit-popup h2 {
    font-family: 'Montserrat', sans-serif;
    color: #FFBD59;
    font-size: 36px;
    margin-bottom: 20px;
}

.fomo-exit-popup p {
    font-family: 'Noto Sans Display', sans-serif;
    color: #DEBC81;
    font-size: 18px;
    line-height: 1.7;
    margin-bottom: 30px;
}

.fomo-exit-popup .fomo-special-offer {
    background: rgba(255,189,89,0.2);
    border: 2px dashed #FFBD59;
    padding: 25px;
    border-radius: 15px;
    margin-bottom: 30px;
}

.fomo-exit-popup .fomo-special-offer .fomo-discount {
    font-family: 'Montserrat', sans-serif;
    font-size: 48px;
    font-weight: 800;
    color: #FFBD59;
    margin: 10px 0;
}

/* Email Form Styles */
.fomo-exit-popup .fomo-email-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 20px;
}

.fomo-exit-popup .fomo-email-input {
    width: 100%;
    padding: 15px 20px;
    border: 2px solid rgba(255,189,89,0.5);
    border-radius: 50px;
    background: rgba(0,0,0,0.3);
    color: #FFFFFF;
    font-family: 'Noto Sans Display', sans-serif;
    font-size: 16px;
    text-align: center;
    outline: none;
    transition: all 0.3s;
}

.fomo-exit-popup .fomo-email-input:focus {
    border-color: #FFBD59;
    box-shadow: 0 0 15px rgba(255,189,89,0.3);
}

.fomo-exit-popup .fomo-email-input::placeholder {
    color: rgba(222,188,129,0.7);
}

.fomo-exit-popup .fomo-exit-cta {
    display: inline-block;
    background: #FFBD59;
    color: #112250;
    padding: 20px 50px;
    font-family: 'Montserrat', sans-serif;
    font-size: 20px;
    font-weight: 700;
    text-decoration: none;
    border-radius: 50px;
    transition: all 0.3s;
    border: 3px solid #FFBD59;
    cursor: pointer;
}

.fomo-exit-popup .fomo-exit-cta:hover {
    background: transparent;
    color: #FFBD59;
    transform: scale(1.05);
}

.fomo-exit-popup .fomo-exit-cta:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.fomo-exit-popup .fomo-no-thanks {
    display: block;
    margin-top: 20px;
    color: rgba(222,188,129,0.6);
    font-family: 'Noto Sans Display', sans-serif;
    font-size: 14px;
    text-decoration: none;
    cursor: pointer;
}

.fomo-exit-popup .fomo-no-thanks:hover {
    color: #DEBC81;
}

/* Success State Styles */
.fomo-exit-popup .fomo-success-content {
    text-align: center;
}

.fomo-exit-popup .fomo-discount-code-box {
    background: rgba(0,0,0,0.4);
    border: 2px dashed #FFBD59;
    border-radius: 15px;
    padding: 20px;
    margin: 20px 0;
}

.fomo-exit-popup .fomo-discount-code {
    font-family: 'Montserrat', sans-serif;
    font-size: 32px;
    font-weight: 900;
    color: #FFBD59;
    letter-spacing: 3px;
    margin-bottom: 10px;
}

.fomo-exit-popup .fomo-copy-btn {
    background: #FFBD59;
    color: #112250;
    border: none;
    padding: 10px 20px;
    border-radius: 25px;
    font-family: 'Montserrat', sans-serif;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
}

.fomo-exit-popup .fomo-copy-btn:hover {
    background: #FFD700;
    transform: scale(1.05);
}

.fomo-exit-popup .fomo-instructions {
    background: rgba(34,197,94,0.2);
    border-radius: 12px;
    padding: 20px;
    margin-top: 20px;
    text-align: left;
}

.fomo-exit-popup .fomo-instructions h4 {
    color: #22c55e;
    font-family: 'Montserrat', sans-serif;
    font-size: 14px;
    margin-bottom: 12px;
}

.fomo-exit-popup .fomo-instructions p {
    font-size: 13px;
    color: #FFFFFF;
    margin: 8px 0;
    line-height: 1.5;
}

.fomo-exit-popup .fomo-instructions strong {
    color: #FFBD59;
}

/* ============================================
   ELEMENT 5: PROGRESS BAR
   ============================================ */
.fomo-scroll-progress {
    position: fixed;
    top: 0;
    left: 0;
    width: 0%;
    height: 5px;
    background: linear-gradient(90deg, #FFBD59 0%, #9C0612 100%);
    z-index: 100000;
    transition: width 0.1s linear;
    box-shadow: 0 0 10px rgba(255,189,89,0.8);
}

/* ============================================
   ELEMENT 4: SPOTS COUNTER SECTION (inline, not sticky)
   ============================================ */
.fomo-spots-section {
    background: linear-gradient(135deg, #761E0B 0%, #9C0612 100%);
    color: #FFFFFF;
    padding: 50px 20px;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.fomo-spots-section::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,189,89,0.15) 0%, transparent 70%);
    animation: fomo-rotate 20s linear infinite;
}

@keyframes fomo-rotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.fomo-spots-section .fomo-spots-inner {
    position: relative;
    z-index: 1;
    max-width: 500px;
    margin: 0 auto;
}

.fomo-spots-section .fomo-warning-icon {
    font-size: 50px;
    margin-bottom: 10px;
    animation: fomo-shake 2s ease-in-out infinite;
}

@keyframes fomo-shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}

.fomo-spots-section h3 {
    font-family: 'Montserrat', sans-serif;
    font-size: 22px;
    color: #FFBD59;
    margin-bottom: 10px;
}

.fomo-spots-section .fomo-spots-number {
    font-family: 'Montserrat', sans-serif;
    font-size: 64px;
    font-weight: 800;
    color: #FFBD59;
    margin: 10px 0;
    text-shadow: 0 0 30px rgba(255,189,89,0.8);
    animation: fomo-pulse 1.5s ease-in-out infinite;
}

@keyframes fomo-pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.fomo-spots-section .fomo-spots-bar {
    width: 100%;
    max-width: 400px;
    height: 20px;
    background: rgba(0,0,0,0.3);
    border-radius: 10px;
    margin: 20px auto;
    overflow: hidden;
}

.fomo-spots-section .fomo-spots-fill {
    height: 100%;
    background: linear-gradient(90deg, #FFBD59 0%, #FF6B6B 100%);
    border-radius: 10px;
    transition: width 1s ease-out;
}

.fomo-spots-section .fomo-warning-text {
    font-family: 'Noto Sans Display', sans-serif;
    font-size: 14px;
    color: #DEBC81;
    margin-top: 15px;
    line-height: 1.6;
}

/* ============================================
   RESPONSIVE
   ============================================ */
@media (max-width: 768px) {
    .fomo-sticky-countdown-bar {
        padding: 6px 10px;
    }

    .fomo-sticky-countdown-bar .fomo-content {
        gap: 8px;
    }

    .fomo-sticky-countdown-bar .fomo-message {
        font-size: 11px;
        max-width: 80px;
        white-space: normal;
        line-height: 1.2;
    }

    .fomo-sticky-countdown-bar .fomo-mini-countdown {
        gap: 4px;
    }

    .fomo-sticky-countdown-bar .fomo-time-box {
        padding: 3px 5px;
        min-width: 28px;
    }

    .fomo-sticky-countdown-bar .fomo-time-box .fomo-num {
        font-size: 13px;
    }

    .fomo-sticky-countdown-bar .fomo-time-box .fomo-label {
        font-size: 8px;
    }

    .fomo-sticky-countdown-bar .fomo-sticky-cta {
        padding: 5px 12px;
        font-size: 10px;
    }

    .fomo-live-ticker {
        left: 10px;
        bottom: 10px;
        max-width: 250px;
        padding: 8px 12px;
    }

    .fomo-live-ticker .fomo-ticker-icon {
        width: 30px;
        height: 30px;
        font-size: 16px;
        margin-right: 8px;
    }

    /* POPUP MOBILE - Compact layout */
    .fomo-exit-popup {
        padding: 25px 15px;
        max-height: 90vh;
        overflow-y: auto;
    }

    .fomo-exit-popup .fomo-emoji {
        font-size: 50px;
        margin-bottom: 10px;
    }

    .fomo-exit-popup h2 {
        font-size: 22px;
        margin-bottom: 10px;
    }

    .fomo-exit-popup p {
        font-size: 14px;
        line-height: 1.5;
        margin-bottom: 15px;
    }

    .fomo-exit-popup .fomo-special-offer {
        padding: 15px;
        margin-bottom: 15px;
    }

    .fomo-exit-popup .fomo-special-offer .fomo-discount {
        font-size: 32px;
    }

    .fomo-exit-popup .fomo-email-input {
        padding: 12px 15px;
        font-size: 14px;
    }

    .fomo-exit-popup .fomo-exit-cta {
        padding: 12px 25px;
        font-size: 16px;
    }

    .fomo-exit-popup .fomo-discount-code {
        font-size: 22px;
        letter-spacing: 2px;
    }

    .fomo-exit-popup .fomo-discount-code-box {
        padding: 15px;
        margin: 15px 0;
    }

    .fomo-exit-popup .fomo-instructions {
        padding: 12px;
        margin-top: 12px;
    }

    .fomo-exit-popup .fomo-instructions h4 {
        font-size: 12px;
        margin-bottom: 8px;
    }

    .fomo-exit-popup .fomo-instructions p {
        font-size: 11px;
        margin: 5px 0;
    }

    .fomo-exit-popup .fomo-no-thanks {
        font-size: 12px;
        margin-top: 12px;
    }

    /* Spots Section Mobile */
    .fomo-spots-section {
        padding: 40px 15px;
    }

    .fomo-spots-section .fomo-warning-icon {
        font-size: 40px;
    }

    .fomo-spots-section h3 {
        font-size: 18px;
    }

    .fomo-spots-section .fomo-spots-number {
        font-size: 48px;
    }

    .fomo-spots-section .fomo-warning-text {
        font-size: 12px;
    }
}

@media (max-width: 400px) {
    .fomo-sticky-countdown-bar .fomo-message {
        display: none;
    }

    .fomo-sticky-countdown-bar .fomo-content {
        justify-content: center;
    }

    .fomo-live-ticker {
        max-width: 220px;
        padding: 7px 10px;
    }

    .fomo-exit-popup {
        padding: 20px 12px;
    }

    .fomo-exit-popup .fomo-emoji {
        font-size: 40px;
    }

    .fomo-exit-popup h2 {
        font-size: 20px;
    }

    .fomo-exit-popup .fomo-special-offer .fomo-discount {
        font-size: 28px;
    }
}
</style>
</head>
<body style="margin: 0; padding: 0; font-family: 'Noto Sans Display', sans-serif;">

<div class="fomo-container">
    <!-- ELEMENT 1: Sticky Countdown Bar -->
    <div class="fomo-sticky-countdown-bar">
        <div class="fomo-content">
            <div class="fomo-message">
                ∆ØU ƒê√ÉI K·∫æT TH√öC
            </div>
            <div class="fomo-mini-countdown">
                <div class="fomo-time-box">
                    <span class="fomo-num" id="fomo-sticky-days">02</span>
                    <span class="fomo-label">Ng√†y</span>
                </div>
                <div class="fomo-time-box">
                    <span class="fomo-num" id="fomo-sticky-hours">14</span>
                    <span class="fomo-label">Gi·ªù</span>
                </div>
                <div class="fomo-time-box">
                    <span class="fomo-num" id="fomo-sticky-mins">27</span>
                    <span class="fomo-label">Ph√∫t</span>
                </div>
                <div class="fomo-time-box">
                    <span class="fomo-num" id="fomo-sticky-secs">33</span>
                    <span class="fomo-label">Gi√¢y</span>
                </div>
            </div>
            <a href="#cta" class="fomo-sticky-cta">ƒêƒÇNG K√ù</a>
        </div>
    </div>

    <!-- ELEMENT 2: Live Registration Ticker -->
    <div class="fomo-live-ticker" id="fomo-liveTicker">
        <div class="fomo-ticker-icon">üë§</div>
        <div class="fomo-ticker-content">
            <div class="fomo-ticker-name" id="fomo-tickerName">Nguy·ªÖn VƒÉn A</div>
            <div class="fomo-ticker-action">v·ª´a ƒëƒÉng k√Ω</div>
            <div class="fomo-ticker-time" id="fomo-tickerTime">2 ph√∫t tr∆∞·ªõc</div>
        </div>
    </div>

    <!-- ELEMENT 3: Spots Counter Section (inline) -->
    <section class="fomo-spots-section">
        <div class="fomo-spots-inner">
            <div class="fomo-warning-icon">‚ö†Ô∏è</div>
            <h3>CH·ªà C√íN L·∫†I</h3>
            <div class="fomo-spots-number" id="fomo-spotsRemaining">50</div>
            <p style="font-size: 18px; color: #FFFFFF; font-weight: 600; margin: 0;">CH·ªñ / 50 CH·ªñ</p>
            <div class="fomo-spots-bar">
                <div class="fomo-spots-fill" id="fomo-spotsBar" style="width: 100%;"></div>
            </div>
            <p class="fomo-warning-text">
                ‚è∞ H∆°n 200 ng∆∞·ªùi ƒëang xem trang n√†y<br>
                üî• 3 ng∆∞·ªùi v·ª´a ƒëƒÉng k√Ω trong 10 ph√∫t qua
            </p>
        </div>
    </section>

    <!-- ELEMENT 4: Exit Intent Popup -->
    <div class="fomo-exit-popup-overlay" id="fomo-exitPopup">
        <div class="fomo-exit-popup" id="fomo-exitPopupContent">
            <button class="fomo-close-btn" onclick="fomoCloseExitPopup()">&times;</button>

            <div class="fomo-emoji">‚úã</div>
            <h2>Khoan ƒê√£!</h2>
            <p>Tr∆∞·ªõc khi b·∫°n r·ªùi ƒëi, ch√∫ng t√¥i c√≥ m·ªôt <strong style="color: #FFBD59;">∆∞u ƒë√£i ƒë·∫∑c bi·ªát</strong> d√†nh ri√™ng cho b·∫°n...</p>

            <div class="fomo-special-offer">
                <p style="margin: 0; font-size: 20px; color: #FFBD59; font-weight: 600;">GI·∫¢M TH√äM</p>
                <div class="fomo-discount">200.000ƒë</div>
                <p style="margin: 0; font-size: 16px; color: #DEBC81;">Ch·ªâ d√†nh cho 50 ng∆∞·ªùi ƒë·∫ßu ti√™n!</p>
            </div>

            <form class="fomo-email-form" id="fomo-emailForm">
                <input
                    type="email"
                    class="fomo-email-input"
                    id="fomo-emailInput"
                    placeholder="Nh·∫≠p email c·ªßa b·∫°n..."
                    required
                >
                <button type="submit" class="fomo-exit-cta" id="fomo-submitBtn">
                    NH·∫¨N ∆ØU ƒê√ÉI NGAY
                </button>
            </form>

            <a class="fomo-no-thanks" onclick="fomoCloseExitPopup()">Kh√¥ng, t√¥i kh√¥ng quan t√¢m</a>
        </div>
    </div>

    <!-- ELEMENT 5: Scroll Progress Bar -->
    <div class="fomo-scroll-progress" id="fomo-scrollProgress"></div>
</div>

<!-- JavaScript -->
<script>
(function() {
    'use strict';

    // ==================== SUPABASE CONFIG ====================
    const SUPABASE_URL = 'https://pgfkbcnzqozzkohwbgbk.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBnZmtiY256cW96emtvaHdiZ2JrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxNzc1MzYsImV4cCI6MjA3Nzc1MzUzNn0.1De0-m3GhFHUrKl-ViqX_r6bydVFoWDaW8DsxhhbjEc';
    const SHOPIFY_DISCOUNT_CODE = 'FREQ200K'; // M√£ chung trong Shopify

    // ==================== STATE ====================
    var fomoSpotsLeft = 50;
    var fomoExitShown = false;

    // ==================== COUNTDOWN TIMER ====================
    var fomoEndTime = new Date().getTime() + (2.5 * 24 * 60 * 60 * 1000);

    // Try to get persistent countdown from localStorage
    var storedEndTime = localStorage.getItem('fomoFrequencyCountdownEnd');
    if (storedEndTime && Number(storedEndTime) > Date.now()) {
        fomoEndTime = Number(storedEndTime);
    } else {
        localStorage.setItem('fomoFrequencyCountdownEnd', fomoEndTime);
    }

    function fomoUpdateCountdown() {
        var now = new Date().getTime();
        var diff = fomoEndTime - now;

        if (diff < 0) {
            document.getElementById('fomo-sticky-days').textContent = '00';
            document.getElementById('fomo-sticky-hours').textContent = '00';
            document.getElementById('fomo-sticky-mins').textContent = '00';
            document.getElementById('fomo-sticky-secs').textContent = '00';
            return;
        }

        var days = Math.floor(diff / (1000 * 60 * 60 * 24));
        var hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        var secs = Math.floor((diff % (1000 * 60)) / 1000);

        document.getElementById('fomo-sticky-days').textContent = (days < 10 ? '0' : '') + days;
        document.getElementById('fomo-sticky-hours').textContent = (hours < 10 ? '0' : '') + hours;
        document.getElementById('fomo-sticky-mins').textContent = (mins < 10 ? '0' : '') + mins;
        document.getElementById('fomo-sticky-secs').textContent = (secs < 10 ? '0' : '') + secs;
    }

    fomoUpdateCountdown();
    setInterval(fomoUpdateCountdown, 1000);

    // ==================== LIVE TICKER ====================
    var fomoNames = [
        'Nguy·ªÖn VƒÉn A (TP.HCM)',
        'Tr·∫ßn Th·ªã B (H√† N·ªôi)',
        'L√™ Minh C (ƒê√† N·∫µng)',
        'Ph·∫°m Thu D (C·∫ßn Th∆°)',
        'Ho√†ng Anh E (H·∫£i Ph√≤ng)',
        'V≈© Th·ªã F (Hu·∫ø)',
        'ƒê·∫∑ng VƒÉn G (Nha Trang)',
        'B√πi Thu H (V≈©ng T√†u)'
    ];
    var fomoTimes = ['1 ph√∫t tr∆∞·ªõc', '3 ph√∫t tr∆∞·ªõc', '5 ph√∫t tr∆∞·ªõc', '8 ph√∫t tr∆∞·ªõc', '12 ph√∫t tr∆∞·ªõc'];

    function fomoShowTicker() {
        var ticker = document.getElementById('fomo-liveTicker');
        if (!ticker) return;

        var randomName = fomoNames[Math.floor(Math.random() * fomoNames.length)];
        var randomTime = fomoTimes[Math.floor(Math.random() * fomoTimes.length)];

        document.getElementById('fomo-tickerName').textContent = randomName;
        document.getElementById('fomo-tickerTime').textContent = randomTime;

        ticker.classList.add('fomo-show');

        setTimeout(function() {
            ticker.classList.remove('fomo-show');
        }, 5000);
    }

    setInterval(function() {
        fomoShowTicker();
    }, Math.random() * 10000 + 10000);

    setTimeout(fomoShowTicker, 3000);

    // ==================== UPDATE SPOTS DISPLAY ====================
    function updateSpotsDisplay() {
        var spotsEl = document.getElementById('fomo-spotsRemaining');
        var barEl = document.getElementById('fomo-spotsBar');
        if (spotsEl) {
            spotsEl.textContent = fomoSpotsLeft;
        }
        if (barEl) {
            var percentage = (fomoSpotsLeft / 50) * 100;
            barEl.style.width = percentage + '%';
        }
    }

    // ==================== FETCH STATS (for popup display) ====================
    async function fetchFrequencyLeadsStats() {
        try {
            var response = await fetch(SUPABASE_URL + '/rest/v1/rpc/get_frequency_leads_stats', {
                method: 'POST',
                headers: {
                    'apikey': SUPABASE_ANON_KEY,
                    'Authorization': 'Bearer ' + SUPABASE_ANON_KEY,
                    'Content-Type': 'application/json',
                }
            });
            if (response.ok) {
                var data = await response.json();
                fomoSpotsLeft = data.first_50_remaining || 0;
                updateSpotsDisplay(); // Update the spots counter in DOM
                console.log('[FOMO Frequency] Stats loaded:', data);
            }
        } catch (error) {
            console.log('[FOMO Frequency] Could not fetch stats, using default');
        }
    }

    fetchFrequencyLeadsStats();
    updateSpotsDisplay(); // Initialize display

    // ==================== EXIT INTENT POPUP ====================
    document.addEventListener('mouseout', function(e) {
        if (!fomoExitShown && e.clientY < 50 && e.relatedTarget == null) {
            var popup = document.getElementById('fomo-exitPopup');
            if (popup) {
                popup.classList.add('fomo-show');
                fomoExitShown = true;
            }
        }
    });

    // Mobile: Show popup after 30 seconds of scrolling
    var mobileScrollTimeout;
    if (window.innerWidth <= 768) {
        window.addEventListener('scroll', function() {
            if (!fomoExitShown && !mobileScrollTimeout) {
                mobileScrollTimeout = setTimeout(function() {
                    var popup = document.getElementById('fomo-exitPopup');
                    if (popup && !fomoExitShown) {
                        popup.classList.add('fomo-show');
                        fomoExitShown = true;
                    }
                }, 30000);
            }
        });
    }

    window.fomoCloseExitPopup = function() {
        var popup = document.getElementById('fomo-exitPopup');
        if (popup) {
            popup.classList.remove('fomo-show');
        }
    };

    // ==================== EMAIL FORM SUBMISSION ====================
    var emailForm = document.getElementById('fomo-emailForm');
    if (emailForm) {
        emailForm.addEventListener('submit', async function(e) {
            e.preventDefault();

            var emailInput = document.getElementById('fomo-emailInput');
            var submitBtn = document.getElementById('fomo-submitBtn');
            var email = emailInput.value.trim().toLowerCase();

            if (!email) {
                alert('Vui l√≤ng nh·∫≠p email');
                return;
            }

            // Validate email format
            var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Email kh√¥ng h·ª£p l·ªá');
                return;
            }

            // Disable button
            submitBtn.disabled = true;
            submitBtn.textContent = 'ƒêang x·ª≠ l√Ω...';

            try {
                // Get UTM params
                var urlParams = new URLSearchParams(window.location.search);

                // Insert to Supabase
                var response = await fetch(SUPABASE_URL + '/rest/v1/frequency_leads', {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': 'Bearer ' + SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation',
                    },
                    body: JSON.stringify({
                        email: email,
                        source: 'fomo_popup',
                        utm_source: urlParams.get('utm_source') || null,
                        utm_medium: urlParams.get('utm_medium') || null,
                        utm_campaign: urlParams.get('utm_campaign') || null,
                        referrer_url: document.referrer || null
                    })
                });

                var data = null;

                if (response.ok) {
                    var result = await response.json();
                    data = Array.isArray(result) ? result[0] : result;
                    data.is_first_50 = data.queue_number <= 50;
                } else if (response.status === 409) {
                    // Duplicate email - fetch existing record
                    var existingRes = await fetch(SUPABASE_URL + '/rest/v1/frequency_leads?email=eq.' + encodeURIComponent(email) + '&select=*', {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': 'Bearer ' + SUPABASE_ANON_KEY,
                        }
                    });
                    var existing = await existingRes.json();
                    if (existing && existing[0]) {
                        data = existing[0];
                        data.is_first_50 = data.queue_number <= 50;
                        data.already_registered = true;
                    }
                } else {
                    var errorData = await response.json();
                    throw new Error(errorData.message || 'ƒêƒÉng k√Ω th·∫•t b·∫°i');
                }

                if (data && data.id) {
                    // Success! Update popup content
                    var popupContent = document.getElementById('fomo-exitPopupContent');
                    var isFirst50 = data.is_first_50;
                    var queueNum = data.queue_number;

                    if (isFirst50) {
                        // Show success with discount code
                        popupContent.innerHTML =
                            '<button class="fomo-close-btn" onclick="fomoCloseExitPopup()">&times;</button>' +
                            '<div class="fomo-emoji">üéâ</div>' +
                            '<h2>CH√öC M·ª™NG B·∫†N!</h2>' +
                            '<p>B·∫°n l√† ng∆∞·ªùi th·ª© <strong style="color:#FFBD59;font-size:28px;">#' + queueNum + '</strong> trong 50 ng∆∞·ªùi ƒë·∫ßu ti√™n!</p>' +
                            '<div class="fomo-discount-code-box">' +
                                '<p style="color:#FFBD59;font-weight:700;margin:0 0 10px 0;">üéÅ M√É GI·∫¢M GI√Å C·ª¶A B·∫†N:</p>' +
                                '<div class="fomo-discount-code">' + SHOPIFY_DISCOUNT_CODE + '</div>' +
                                '<button class="fomo-copy-btn" onclick="navigator.clipboard.writeText(\'' + SHOPIFY_DISCOUNT_CODE + '\');this.textContent=\'ƒê√£ copy!\';setTimeout(function(){document.querySelector(\'.fomo-copy-btn\').textContent=\'üìã Copy m√£\';},2000)">üìã Copy m√£</button>' +
                            '</div>' +
                            '<div class="fomo-instructions">' +
                                '<h4>üìã H∆Ø·ªöNG D·∫™N S·ª¨ D·ª§NG:</h4>' +
                                '<p><strong>B∆∞·ªõc 1:</strong> Ch·ªçn kh√≥a h·ªçc b√™n d∆∞·ªõi</p>' +
                                '<p><strong>B∆∞·ªõc 2:</strong> Nh·∫≠p m√£ <strong>' + SHOPIFY_DISCOUNT_CODE + '</strong> ·ªü trang thanh to√°n</p>' +
                                '<p><strong>B∆∞·ªõc 3:</strong> Nh·∫≠n ngay gi·∫£m gi√° <strong>200.000ƒë</strong></p>' +
                            '</div>' +
                            '<a href="#cta" class="fomo-exit-cta" style="margin-top:20px;display:inline-block;" onclick="fomoCloseExitPopup()">üöÄ CH·ªåN KH√ìA H·ªåC NGAY</a>' +
                            '<p style="color:rgba(222,188,129,0.7);font-size:12px;margin-top:15px;">‚è∞ Ch·ªâ c√≤n ' + (50 - queueNum) + ' su·∫•t ∆∞u ƒë√£i!</p>';
                    } else {
                        // After 50 - No discount
                        popupContent.innerHTML =
                            '<button class="fomo-close-btn" onclick="fomoCloseExitPopup()">&times;</button>' +
                            '<div class="fomo-emoji">‚úÖ</div>' +
                            '<h2>ƒêƒÇNG K√ù TH√ÄNH C√îNG!</h2>' +
                            '<p>B·∫°n l√† ng∆∞·ªùi ƒëƒÉng k√Ω th·ª© <strong>#' + queueNum + '</strong></p>' +
                            '<div style="background:rgba(239,68,68,0.2);border-radius:12px;padding:20px;margin:20px 0;">' +
                                '<p style="color:#ff6b6b;font-size:14px;margin:0;">üò¢ R·∫•t ti·∫øc! ∆Øu ƒë√£i 50 ng∆∞·ªùi ƒë·∫ßu ti√™n ƒë√£ h·∫øt.</p>' +
                            '</div>' +
                            '<p style="color:#DEBC81;font-size:14px;">Ch√∫ng t√¥i s·∫Ω g·ª≠i th√¥ng tin ∆∞u ƒë√£i kh√°c qua email <strong style="color:#FFBD59;">' + email + '</strong></p>' +
                            '<a href="#cta" class="fomo-exit-cta" style="margin-top:20px;display:inline-block;" onclick="fomoCloseExitPopup()">XEM KH√ìA H·ªåC</a>';
                    }

                    // Refresh stats
                    fetchFrequencyLeadsStats();
                }

            } catch (error) {
                console.error('[FOMO Frequency] Registration error:', error);
                alert('Kh√¥ng th·ªÉ k·∫øt n·ªëi. Vui l√≤ng th·ª≠ l·∫°i!');

                submitBtn.disabled = false;
                submitBtn.textContent = 'NH·∫¨N ∆ØU ƒê√ÉI NGAY';
            }
        });
    }

    // ==================== SCROLL PROGRESS BAR ====================
    window.addEventListener('scroll', function() {
        var winScroll = document.body.scrollTop || document.documentElement.scrollTop;
        var height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        var scrolled = (winScroll / height) * 100;
        var progressBar = document.getElementById('fomo-scrollProgress');
        if (progressBar) {
            progressBar.style.width = scrolled + '%';
        }
    });

    console.log('[FOMO Frequency] All elements loaded successfully!');
})();
</script>

</body>
</html>
