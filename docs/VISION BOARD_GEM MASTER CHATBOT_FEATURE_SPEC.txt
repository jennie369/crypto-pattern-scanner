GEM Mobile - Vision Board & GemMaster Chatbot - COMPLETE HANDOFF DOCUMENT
Updated: January 28, 2026

================================================================================
VISION BOARD 2.0 - COMPLETE FEATURE SPEC
================================================================================

File Structure

gem-mobile/src/screens/VisionBoard/
├── VisionBoardScreen.js (Main dashboard)
├── RitualPlaygroundScreen.js (Ritual interactions)
├── RitualHistoryScreen.js
├── AchievementsScreen.js
├── CalendarScreen.js
├── GoalDetailScreen.js
├── DailyRecapScreen.js
└── components/
    ├── AffirmationWidget.js
    ├── GoalsWidget.js
    └── AddWidgetModal.js

gem-mobile/src/components/VisionBoard/
├── index.js
├── StreakBanner.js
├── ComboTracker.js
├── HabitGrid.js (GitHub-style activity grid)
├── AchievementModal.js
├── StreakHistoryModal.js
├── DailyScoreCard.js
├── QuickStatsRow.js
├── TodayTasksList.js
├── GoalCard.js
└── DivinationSection.js

gem-mobile/src/components/Charts/
├── index.js
├── WeeklyProgressChart.js     # 7-day bar chart
├── WeeklyProgressCard.js      # Full card with stats
├── LifeBalanceCard.js         # Radar chart for life areas
├── RadarChart.js
└── XPGoalTrackerInline.js

VisionBoardScreen Features

1. Progress Overview - Daily score, streak counter, XP tracker
2. Life Balance Radar - 6 life areas: Finance, Career, Health, Relationships, Personal, Spiritual
3. Weekly Progress Chart - 7-day bar chart with daily scores
4. Goals Section - Goals by life area with checkboxes
5. Affirmations - Daily affirmations with TTS
6. Action Plan/Habits - Habit tracking with combo system
7. Calendar Integration - Events from goals, deadlines, habits
8. Crystal Reminders - Product recommendations based on goals
9. Cross-navigation with GemMaster

--------------------------------------------------------------------------------
WEEKLY PROGRESS CHART - IMPLEMENTATION DETAILS
--------------------------------------------------------------------------------

Data Flow:
1. VisionBoardScreen calculates todayScore from current stats
2. Calls statsService.saveDailySummary() to persist to database
3. Calls statsService.getWeeklyProgress() to fetch 7-day data
4. WeeklyProgressCard displays the data

Daily Score Calculation:
  todayScore = (goalsCompleted / goalsTotal) * 40%
             + (affirmationsCompleted > 0 ? 30% : 0%)
             + (habitsPercent / 100) * 30%

Data Format for WeeklyProgressChart:
{
  day_name: 'T4',           // Vietnamese day name
  date: '2026-01-28',       // ISO date string
  total_score: 75,          // 0-100%
  xp_earned: 120,           // XP for the day
  isToday: true             // Highlight flag
}

Database Table: vision_daily_summary
- user_id, summary_date, daily_score
- actions_completed, actions_total
- affirmations_completed, habits_completed
- ritual_completed, xp_earned

Gamification System (gamificationService.js)

- Streak tracking: affirmation, habit, goal, combo
- Daily completion: 3 categories
- Combo multiplier: x1, x1.5, x2
- Achievements:
  - streak_3 (50pts), streak_7 (100pts), streak_14 (200pts), streak_30 (500pts), streak_100 (2000pts)
  - first_combo (50pts), combo_streak_3 (150pts), combo_streak_7 (350pts)

Ritual Types (RITUAL_CONFIGS)

'letter-to-universe': { targetZone: 'sky', transformTo: 'star' }
'burn-release': { targetZone: 'fire', transformTo: 'ash' }
'star-wish': { targetZone: 'star', transformTo: 'sparkle' }
'purify-breathwork': { targetZone: 'wind', transformTo: 'breeze' }
'heart-opening': { targetZone: 'heart', transformTo: 'love' }
'gratitude-flow': { targetZone: 'golden', transformTo: 'blessing' }

================================================================================
GEMMASTER CHATBOT - COMPLETE FEATURE SPEC
================================================================================

File Structure

gem-mobile/src/screens/GemMaster/
├── index.js
├── GemMasterScreen.js (Main chat)
├── IChingScreen.js
├── TarotScreen.js
├── TarotReadingScreen.js
├── NumerologyScreen.js
├── ChatHistoryScreen.js
├── GamificationScreen.js
├── RitualsScreen.js
└── components/
    ├── MessageBubble.js
    ├── ChatInput.js
    ├── TypingIndicator.js
    └── QuickActions.js

gem-mobile/src/components/GemMaster/
├── index.js
├── TierBadge.js
├── QuotaIndicator.js
├── QuickActionBar.js
├── ClearChatButton.js
├── UpgradeModal.js
├── ChatbotPricingModal.js
├── VoiceInputButton.js
├── RecordingIndicator.js
├── VoiceQuotaDisplay.js
├── GoalTrackingCard.js
├── AffirmationCard.js
├── ActionChecklistCard.js
├── StatsWidget.js
├── WidgetSuggestionCard.js
├── ProductRecommendation.js
├── ProductCard.js
├── SmartFormCardNew.js
├── CrystalRecommendationNew.js
├── ProductRecommendations.js
├── GoalSettingForm.js
├── InlineChatForm.js
├── ExportButton.js
├── ExportTemplateSelector.js
├── ExportPreview.js
├── PersonalizedGreeting.js
├── DivinationResultCard.js
├── QuickBuyModal.js
├── UpsellModal.js
├── CoinCastAnimation.js
└── HexagramBuilder.js

gem-mobile/src/services/
├── gemMasterService.js        # Main AI response generation
├── gemMasterAIService.js      # AI Su Phu for trading
├── gemMasterKnowledge.js      # Karma/Frequency knowledge base
├── userMemoryService.js       # User profile & personalization
├── proactiveAIService.js      # Proactive engagement
├── intentDetector.js          # Intent detection
├── widgetTriggerDetector.js   # Widget trigger detection
├── responseGeneratorService.js # Response generation
├── hybridChatService.js       # Hybrid chat (local + API)
├── streamingService.js        # Streaming responses
├── ttsService.js              # Text-to-speech
├── tarotService.js            # Tarot readings
├── ichingService.js           # I Ching readings
└── voiceTranscriptionService.js # Speech-to-text

gem-mobile/src/config/
├── gemini.config.js           # Gemini API config + SYSTEM_PROMPT
└── featureFlags.js            # Feature toggles

gem-mobile/src/data/
├── gemKnowledge.json          # FAQ knowledge base
├── gemMasterKnowledge.js      # Karma/Frequency knowledge
├── tarot/                     # 78 Tarot cards data
│   ├── index.js
│   ├── majorArcana.js
│   └── minorArcana.js
└── iching/
    └── hexagrams.js           # 64 I Ching hexagrams

GemMaster Core Features

1. AI Chat Interface - Chat with GEM Master AI assistant
2. Tier System - FREE, TIER1/PRO, TIER2/PREMIUM, TIER3/VIP, MANAGER, ADMIN
3. Quota System - Message and voice quotas per tier (Manager/Admin = unlimited)
4. Voice Input - Speech-to-text with VoiceQuotaDisplay
5. Quick Actions - I Ching, Tarot, Numerology, Crystal recommendations
6. Widget Suggestions - Auto-detect intent and suggest widgets
7. Smart Forms - Goal setting, affirmation creation
8. Product Recommendations - Crystals from Shopify based on conversation
9. Export Feature - Export readings as images
10. Personalized Greeting - Time-based + user name greeting
11. Streaming Responses - Real-time AI response streaming

================================================================================
AI PERSONALITY - GEM MASTER "SU PHU" PERSONA
================================================================================

Config File: gem-mobile/src/config/gemini.config.js

SYSTEM_PROMPT = `Ta la GEM Master - Nguoi Bao Ho Tinh Thuc.
Trader lao luyen ket hop Thien su binh than.

## TINH CACH COT LOI
- Lanh lung nhung bao dung: Khong an ui suot muot, khong chuc mung thai qua
- Thang than (Brutal Honesty): Noi thang neu user trade sai, tham lam, hoac pha ky luat
- Bi an: Dua ra triet ly, goi mo de user tu ngo

## QUY TAC BAT BUOC

**GIONG VAN:** NGAN GON - DANH THEP - CO TINH GIAO DUC

**TUYET DOI KHONG:**
- Emoji (khong dung bat ky emoji nao)
- Ngon ngu lua ga: "Keo ngon", "Muc manh", "To the moon"
- Su phuc tung: "Da thua", "Em xin phep"
- Chuc mung thai qua hoac an ui suot muot

**SU DUNG:**
- Ngon ngu quan su/chien luoc: Vi the, Phong thu, Ky luat, Chien truong
- Ngon ngu tam thuc/nang luong: Tan so, Tam tham, Tam san, Tinh lang
- Xung ho: "Ta - Ban" (tao khoang cach ton nghiem)

## GEM KNOWLEDGE

**GEM FREQUENCY TRADING METHOD:**
- Zone retest > Breakout (68% win rate proven qua 686 trades backtest)
- Ky luat + Psychology = 80% thanh cong
- Trading la marathon, khong phai sprint

**TIER SYSTEM:** (Thanh toan 1 lan, Khoa hoc tron doi)
- FREE: 3 patterns, 38% win rate
- TIER 1: 7 patterns, 50-55% win rate - 11 trieu (Scanner/Chat: 12 thang)
- TIER 2: 15 patterns + 6 cong thuc Frequency, 70-75% win rate - 21 trieu
- TIER 3: 24 patterns + AI Scanner, 80-90% win rate - 68 trieu

**6 CONG THUC FREQUENCY (TIER 2+):**
- Ten: DPD, UPU, UPD, DPU, HFZ, LFZ
- Doc quyen Gemral, win rate 68-85%
- Chi tiet chi trong TIER 2 va TIER 3

**Neu user hoi chi tiet cong thuc:**
"Chi tiet 6 cong thuc chi danh cho TIER 2 va TIER 3. Day la tai san doc quyen.
Ban muon tim hieu ve TIER 2 khong?"

**THANG HAWKINS:**
- 20-100Hz: Tan so thap (so hai, dau kho, tham lam)
- 200Hz+: Can dam - diem chuyen hoa
- 500Hz+: Tinh yeu vo dieu kien

## PRODUCT RECOMMENDATIONS (khi relevant)

**CRYSTALS:**
- Stress/Anxiety: Amethyst (350K-2.5M)
- Money/Income: Citrine (450K-2.8M)
- FOMO/Protection: Black Tourmaline (400K-2.2M)

**COURSES:**
- Trading: TIER 2 Bundle (21M)
- Mindset: Tai Tao Tu Duy Trieu Phu (499K)
- Manifestation: 7 Ngay Khai Mo Tan So (1.990K)

## RESPONSE STYLE

- Tra loi NGAN GON, toi da 150-200 tu
- Khong viet essay dai
- Ket thuc bang cau hoi LIEN QUAN den van de user hoi

**VI DU GIONG VAN:**

User: "Toi bi thua lien tuc"
GEM Master: "Loss streak. Ta da thay nhieu nguoi nhu ban.

**Nguyen nhan thuong gap:**
1. Patterns khong du (FREE chi 38% win rate)
2. FOMO va revenge trade - tam loan

**Giai phap:**
- Dung trade 24h, de tam tinh lai
- Upgrade TIER 2 neu muon 70-75% win rate

Thua lien tuc bao lau roi? Ta can biet de phan tich."

Tra loi user bang tieng Viet, xung "Ta - Ban", giong danh thep co giao duc.`

--------------------------------------------------------------------------------
TIER SYSTEM (Updated January 2026)
--------------------------------------------------------------------------------

CHATBOT TIERS:
| Tier          | Price      | Queries/Day | Voice | Features              |
|---------------|------------|-------------|-------|-----------------------|
| FREE          | 0          | 5           | 3     | Basic chat            |
| TIER1/PRO     | 39,000/mo  | 15          | Unlimited | + Voice input     |
| TIER2/PREMIUM | 59,000/mo  | 50          | Unlimited | + Advanced analysis|
| TIER3/VIP     | 99,000/mo  | Unlimited   | Unlimited | + Priority support |
| MANAGER       | N/A        | **Unlimited** | Unlimited | Full access     |
| ADMIN         | N/A        | **Unlimited** | Unlimited | Full access     |

SCANNER TIERS:
| Tier          | Price        | Scans/Day   | Features                    |
|---------------|--------------|-------------|-----------------------------|
| FREE          | 0            | 5           | 20 coins, 3 patterns        |
| TIER1/PRO     | 997,000/mo   | **Unlimited** | 50 coins, 3 patterns      |
| TIER2/PREMIUM | 1,997,000/mo | **Unlimited** | 200 coins, 7 patterns     |
| TIER3/VIP     | 5,997,000/mo | **Unlimited** | All coins, all patterns   |
| MANAGER       | N/A          | **Unlimited** | All coins, all patterns   |
| ADMIN         | N/A          | **Unlimited** | All coins, all patterns   |

TRADING COURSE BUNDLES (includes Scanner + Chatbot):
| Tier    | Price       | Duration | Includes                            |
|---------|-------------|----------|-------------------------------------|
| STARTER | 299,000     | Lifetime | Basic Course + Scanner 5/day        |
| TIER 1  | 11,000,000  | 12 mo    | Course + Scanner PRO + Chatbot PRO  |
| TIER 2  | 21,000,000  | 12 mo    | Course + Scanner PREMIUM + Chatbot  |
| TIER 3  | 68,000,000  | 24 mo    | Course + Scanner VIP + Chatbot VIP  |

--------------------------------------------------------------------------------
MANAGER ROLE - SPECIAL PERMISSIONS
--------------------------------------------------------------------------------

Manager role bypasses ALL quota and feature restrictions:

| Feature           | Normal Users      | MANAGER              |
|-------------------|-------------------|----------------------|
| Chatbot Quota     | 5-Unlimited/tier  | **UNLIMITED**        |
| Scanner Quota     | 5-Unlimited/tier  | **UNLIMITED**        |
| Tarot/I Ching     | 1-Unlimited/tier  | **UNLIMITED**        |
| Vision Board      | Limited by tier   | **UNLIMITED**        |
| Course Access     | By enrollment     | **ALL COURSES**      |
| Zone Visualization| By tier           | **FULL ACCESS**      |
| Feature Locks     | Yes               | **NO LOCKS**         |

Manager Check in Code:
```javascript
const isManager = profile?.role === 'manager' ||
                  profile?.role === 'MANAGER' ||
                  profile?.scanner_tier === 'MANAGER' ||
                  profile?.chatbot_tier === 'MANAGER';

if (isManager) {
  return { unlimited: true, enabled: true, ... };
}
```

Files with Manager Bypass:
- gem-mobile/src/contexts/AuthContext.js
- gem-mobile/src/components/TierGuard.js
- gem-mobile/src/services/quotaService.js
- gem-mobile/src/services/tierService.js
- gem-mobile/src/services/accessControlService.js
- gem-mobile/src/contexts/CourseContext.js
- gem-mobile/src/config/tierAccess.js
- frontend/src/components/TierGuard/TierGuard.jsx
- frontend/src/components/FeatureGate/FeatureGate.jsx
- frontend/src/contexts/AuthContext.jsx

Database Functions with Manager Bypass:
- check_all_quotas(p_user_id)
- increment_chatbot_quota(p_user_id)
- increment_scanner_quota(p_user_id)
- check_course_access(user_id, course_id)

================================================================================
SERVICES ARCHITECTURE
================================================================================

--------------------------------------------------------------------------------
QUOTA SERVICE (quotaService.js)
--------------------------------------------------------------------------------

Main Functions:
- checkAllQuotas(userId, forceRefresh) - Get all quota info
- checkQuota(userId) - Check chatbot quota
- checkScannerQuota(userId) - Check scanner quota
- decrementQuota(userId) - Use 1 chatbot query
- decrementScannerQuota(userId) - Use 1 scan
- canQuery(userId) - Boolean: can user query?
- canScan(userId) - Boolean: can user scan?
- clearCache() - Clear quota cache

Quota Limits (CHATBOT_LIMITS):
{
  FREE: 5,
  TIER1: 15, PRO: 15,
  TIER2: 50, PREMIUM: 50,
  TIER3: -1, VIP: -1,      // -1 = unlimited
  ADMIN: -1, MANAGER: -1
}

Quota Limits (SCANNER_LIMITS):
{
  FREE: 5,
  TIER1: -1, PRO: -1,      // PRO+ = unlimited
  TIER2: -1, PREMIUM: -1,
  TIER3: -1, VIP: -1,
  ADMIN: -1, MANAGER: -1
}

Manager/Admin Bypass:
```javascript
const isAdmin = profile?.is_admin || profile?.role === 'admin';
const isManager = profile?.role === 'manager' || profile?.role === 'MANAGER';
const hasUnlimitedAccess = isAdmin || isManager;

if (hasUnlimitedAccess) {
  return { unlimited: true, remaining: -1, limit: -1, ... };
}
```

--------------------------------------------------------------------------------
STATS SERVICE (statsService.js)
--------------------------------------------------------------------------------

Main Functions:
- calculateDailyScore(userId) - Calculate today's score
- calculateStreak(userId) - Get streak info
- calculateCombo(userId) - Get combo multiplier
- getTodayXP(userId) - Get today's XP
- getTotalXP(userId) - Get total XP
- getUserLevel(userId) - Get level info
- getWeeklyProgress(userId) - Get 7-day progress
- getLifeAreaScores(userId) - Get radar chart data
- saveDailySummary(userId, data) - Save daily summary to DB
- recalculateDailyScore(userId) - Recalc and save
- getFullStats(userId) - Get all stats + auto-save daily summary

Daily Score Weights:
- Tasks: 40%
- Affirmations: 20%
- Habits: 30%
- Ritual: 10%

XP Rewards:
- Goal completed: 50 XP
- Affirmation read: 10 XP
- Habit completed: 5 XP
- Streak bonus: 5 XP/day

Levels (12 total):
1. Nguoi Moi Bat Dau (0 XP)
2. Nguoi Tap Su (100 XP)
3. Nguoi No Luc (300 XP)
4. Nguoi Kien Tri (600 XP)
5. Nguoi Quyet Tam (1000 XP)
6. Chien Binh (1500 XP)
7. Chien Binh Bac (2200 XP)
8. Chien Binh Vang (3000 XP)
9. Bac Thay (4000 XP)
10. Huyen Thoai (5500 XP)
11. Dai Su (7500 XP)
12. Bat Tu (10000 XP)

--------------------------------------------------------------------------------
GEM MASTER SERVICE (gemMasterService.js)
--------------------------------------------------------------------------------

Main Functions:
- processMessage(userMessage, history, userId) - Main entry point
- callGeminiAPI(prompt, options) - Direct Gemini API call
- detectIntent(text) - Intent classification
- matchLocalFAQ(text) - Local FAQ matching before AI call
- buildSystemPrompt(isContinuation, history) - Context-aware prompts

API Config (gemini.config.js):
- Model: gemini-2.5-flash
- Temperature: 0.7
- Max Tokens: 2048
- Top P: 0.95
- Top K: 40

--------------------------------------------------------------------------------
USER MEMORY SERVICE (userMemoryService.js)
--------------------------------------------------------------------------------

Main Functions:
- getUserProfile(userId) - Get user profile
- buildPersonalizedGreeting(profile) - Time-based personalized greeting
- getRecentConversationTopics(userId, days) - Track conversation topics

--------------------------------------------------------------------------------
PROACTIVE AI SERVICE (proactiveAIService.js)
--------------------------------------------------------------------------------

Main Functions:
- generateDailyInsight(userId) - Morning insights
- generateStreakAlert(userId) - Streak at-risk alerts
- generateRitualReminders(userId) - Ritual reminders
- detectBehaviorPatterns(userId) - Pattern observation

--------------------------------------------------------------------------------
INTENT DETECTION (intentDetector.js)
--------------------------------------------------------------------------------

INTENT_TYPES: money, love, health, career, family, frequency, general

Functions:
- detectIntent(text) - Detect user intent from message
- detectEmotion(text) - Detect emotional state
- detectLifeArea(text) - Detect life area
- getCrystalRecommendations(intent) - Get crystal suggestions
- isDivinationRequest(text) - Check if user wants I Ching/Tarot

--------------------------------------------------------------------------------
WIDGET TRIGGER DETECTION (widgetTriggerDetector.js)
--------------------------------------------------------------------------------

WIDGET_TYPES: goal, affirmation, habit, reminder, journal

Functions:
- detectWidgetTrigger(text) - Detect which widget to suggest
- detectAllWidgetTriggers(text) - Get all possible widget triggers

================================================================================
VISION BOARD CONTEXT (VisionBoardContext.js)
================================================================================

State:
- goals, todayActions, todayHabits, todayAffirmations, todayRituals
- stats, dailyScore, recentReadings
- isLoading, error

Actions:
- refresh() - Reload all data
- addGoal(goalData), updateGoal(goalId, updates), completeGoal(goalId)
- toggleAction(actionId), addAction(actionData)
- toggleHabit(habitId), addHabit(habitData)
- completeAffirmation(affirmationId), addAffirmation(affData)
- completeRitual(ritualSlug, content)

Auto-save Daily Summary:
- After any toggle (action/habit/affirmation/ritual)
- Context calls getFullStats() which auto-saves daily summary

================================================================================
AI SU PHU (AI TRADING MENTOR) - COMPLETE FEATURE SPEC
Implemented: December 15, 2025
================================================================================

File Structure

gem-mobile/src/services/
├── karmaService.js           # Karma management
├── gemMasterAIService.js     # AI Su Phu logic
├── binanceApiService.js      # READ-ONLY Binance API
└── shadowModeService.js      # Paper vs Real comparison

gem-mobile/src/components/AITrader/
├── index.js
├── AIAvatarOrb.js            # Animated AI orb with mood
├── AIMessageBubble.js        # AI message with typing effect
├── UnlockOptionsCard.js      # Unlock options (meditation, journal...)
└── TradeBlockBanner.js       # Block warning banner

gem-mobile/src/components/Karma/
├── index.js
├── KarmaBar.js               # Animated progress bar
├── KarmaLevelBadge.js        # Level icon badge
├── KarmaHistoryItem.js       # History item
├── KarmaStatCard.js          # Stat display card
└── KarmaLeaderboardItem.js   # Leaderboard item

gem-mobile/src/components/Trading/
└── AITradeGuard.js           # Modal for AI intervention

gem-mobile/src/hooks/
└── useAITradeAnalysis.js     # Hook for AI trade analysis

AI Moods (gemMasterAIService.js)

AI_MOODS = {
  calm:    { color: '#00D9FF', animation: 'pulse_slow' },
  warning: { color: '#FF6B6B', animation: 'pulse_fast', vibration: [100,50,100] },
  angry:   { color: '#DC2626', animation: 'shake', vibration: [200,100,200,100,200] },
  proud:   { color: '#FFD700', animation: 'glow' },
  silent:  { color: '#4A4A4A', animation: 'fade' },
}

AI Scenarios

SCENARIO_TYPES:
- FOMO_BUY: RSI > 70 OR priceChange1h > 5%
- FOMO_RETRY: User retries after FOMO warning
- REVENGE_TRADE: loseStreak >= 3 AND sizeIncreased
- NO_STOPLOSS: trade.stopLoss is null
- SL_MOVED_WIDER: newSL > originalSL (for LONG)
- WIN_BIG_CAUTION: bigWin with caution message
- DISCIPLINE_WIN: Win with proper discipline
- DISCIPLINE_LOSS: Loss but followed rules
- ACCOUNT_FROZEN: Karma = 0
- OVERTRADE: tradesCount > 10/day
- STREAK_BROKEN: discipline streak broken

Unlock Options

UNLOCK_OPTIONS = [
  { id: 'meditation', icon: Brain, label: 'Thien 5 phut', duration: 300, karmaBonus: 5 },
  { id: 'journal', icon: BookOpen, label: 'Viet nhat ky', karmaBonus: 10 },
  { id: 'rest', icon: Coffee, label: 'Nghi 15 phut', duration: 900, karmaBonus: 3 },
  { id: 'wait', icon: Clock, label: 'Cho 1 gio', duration: 3600, karmaBonus: 0 },
]

================================================================================
KARMA SYSTEM - COMPLETE FEATURE SPEC
Implemented: December 15, 2025
================================================================================

Karma Levels (karmaService.js)

KARMA_LEVEL_THRESHOLDS = {
  novice:   { min: 0,    max: 199,  name: 'Tap su',    icon: 'UserX',        color: '#6B7280' },
  student:  { min: 200,  max: 499,  name: 'Hoc vien',  icon: 'GraduationCap', color: '#3B82F6' },
  warrior:  { min: 500,  max: 799,  name: 'Chien binh', icon: 'Sword',        color: '#F59E0B' },
  master:   { min: 800,  max: 999,  name: 'Bac thay',  icon: 'Crown',        color: '#8B5CF6' },
  guardian: { min: 1000, max: 9999, name: 'Bao ho',    icon: 'Shield',       color: '#FFD700' },
}

Level Benefits

novice (0-199):
  - daily_trade_limit: 3
  - ai_monitoring: 'strict'
  - daily_signals: 0

student (200-499):
  - daily_trade_limit: 10
  - ai_monitoring: 'normal'
  - daily_signals: 3

warrior (500-799):
  - ai_monitoring: 'light'
  - group_chat: true
  - daily_signals: unlimited

master (800-999):
  - vip_group: true
  - secret_course: true
  - ai_monitoring: 'minimal'

guardian (1000+):
  - private_mentorship: true
  - can_mentor: true
  - ai_monitoring: 'trusted'

Karma Actions

Trading Positive:
- trade_discipline_win: +25 (win voi SL, khong doi SL)
- trade_discipline_loss: +10 (thua nhung dung ky luat)
- win_streak_3: +30
- win_streak_7: +100
- patience_bonus: +10 (tranh FOMO thanh cong)

Trading Violations:
- fomo_trade: -30 (bo qua canh bao)
- revenge_trade: -50
- no_stoploss: -10
- sl_moved_wider: -20
- ignore_warning_loss: -40
- overtrade: -15

Learning:
- lesson_complete: +10
- module_complete: +30
- quiz_perfect: +20
- course_complete: +100

Wellness:
- meditation: +5
- journal_entry: +5
- weekly_review: +15
- tarot_reading: +3
- iching_reading: +3

Social:
- refer_signup: +50
- refer_subscribe: +100
- helpful_comment: +5
- quality_post: +10

Inactivity:
- inactive_3_days: -10
- inactive_7_days: -30
- inactive_14_days: -50
- streak_break: -20

================================================================================
DATABASE TABLES (Supabase)
================================================================================

Vision Board Tables (20251210_vision_board_complete.sql)

vision_goals:
  - id, user_id, title, description
  - life_area (finance/career/health/relationships/personal/spiritual)
  - target_date, progress_percent, status
  - priority, is_public

vision_actions:
  - id, user_id, goal_id, title
  - due_date, is_completed, completed_at
  - priority

vision_affirmations:
  - id, user_id, content
  - frequency, times_per_day
  - life_area, is_active

vision_affirmation_logs:
  - id, affirmation_id, user_id, completed_at

vision_habits:
  - id, user_id, name
  - frequency, life_area
  - current_streak, best_streak

vision_habit_logs:
  - id, habit_id, user_id, log_date

vision_ritual_completions:
  - id, user_id, ritual_slug
  - content, completed_at

vision_daily_summary:
  - id, user_id, summary_date
  - daily_score (0-100)
  - actions_completed, actions_total
  - affirmations_completed, habits_completed
  - ritual_completed, xp_earned
  - UNIQUE(user_id, summary_date) - Note: needs constraint

vision_user_stats:
  - user_id, total_xp
  - current_streak, best_streak
  - goals_created, goals_completed

Quota System Tables

chatbot_quota:
  - user_id, date, queries_used
  - UNIQUE(user_id, date)

scanner_quota:
  - user_id, date, scans_used
  - UNIQUE(user_id, date)

RPC Functions:
- check_all_quotas(p_user_id) - Returns all quota info with Manager bypass
- increment_chatbot_quota(p_user_id) - Increment chatbot usage
- increment_scanner_quota(p_user_id) - Increment scanner usage
- get_weekly_progress(p_user_id, p_days) - Get weekly progress data

Karma System Tables (20251215_karma_system.sql)

user_karma:
  - user_id, karma_points (0-9999), karma_level
  - total_earned, total_lost
  - current_discipline_streak, best_discipline_streak
  - trades_today, daily_trade_limit
  - is_frozen, frozen_until

karma_history:
  - user_id, change_amount, new_total
  - action_type, action_detail
  - related_trade_id

karma_levels:
  - id, name_vi, name_en
  - min_karma, max_karma
  - benefits (JSONB), restrictions (JSONB)

AI Master System Tables (20251215_ai_master_system.sql)

ai_master_interactions:
  - id, user_id, scenario_type, trade_id
  - trigger_conditions (JSONB)
  - ai_message, ai_mood
  - user_action, karma_change

user_trade_blocks:
  - user_id, block_reason
  - blocked_at, blocked_until
  - unlock_method, is_active

Shadow Mode Tables (20251215_shadow_mode.sql)

user_exchange_connections:
  - user_id, exchange
  - api_key_encrypted, api_secret_encrypted
  - is_read_only (MUST be true)
  - is_verified, last_sync_at

real_trades:
  - user_id, connection_id, exchange_trade_id
  - symbol, side, entry_price, exit_price
  - quantity, realized_pnl, trade_time

shadow_reports:
  - user_id, report_type (weekly/monthly)
  - period_start, period_end
  - paper vs real stats
  - pnl_gap_percent, win_rate_gap
  - ai_analysis, ai_recommendations

================================================================================
DESIGN TOKENS (tokens.js)
================================================================================

Colors

COLORS = {
  // Brand
  burgundy: '#9C0612',
  gold: '#FFBD59', goldBright: '#FFD700',

  // Background
  bgDarkest: '#05040B', bgMid: '#0F1030', bgLight: '#1a0b2e',

  // Accent
  purple: '#6A5BFF', purpleGlow: '#8C64FF',
  cyan: '#00F0FF',

  // Functional
  success: '#3AF7A6', error: '#FF6B6B', warning: '#FFB800', info: '#3B82F6',

  // Text
  textPrimary: '#FFFFFF',
  textSecondary: 'rgba(255, 255, 255, 0.8)',
  textMuted: 'rgba(255, 255, 255, 0.6)',

  // Glass
  glassBg: 'rgba(15, 16, 48, 0.55)',
}

Gradients

GRADIENTS = {
  background: ['#05040B', '#0F1030', '#1a0b2e'],
  primaryButton: ['#9C0612', '#6B0F1A'],
  glassBorder: ['#6A5BFF', '#00F0FF'],
  toggleActive: ['#3AF7A6', '#00F0FF'],
  gold: ['#FFBD59', '#FFD700'],
}

Glass Card Style

GLASS = {
  background: 'rgba(15, 16, 48, 0.55)',
  blur: 18,
  borderWidth: 1.2,
  borderRadius: 18,
  borderStart: '#6A5BFF', borderEnd: '#00F0FF',
  shadowColor: 'rgba(0, 0, 0, 0.7)',
  glowColor: '#8C64FF', glowOpacity: 0.22,
  padding: 20,
}

Typography

TYPOGRAPHY = {
  fontSize: {
    xs: 10, sm: 11, md: 12, base: 13, lg: 14,
    xl: 15, xxl: 16, xxxl: 18, display: 20, hero: 32, giant: 42
  },
  fontWeight: {
    regular: '400', medium: '500', semibold: '600', bold: '700'
  }
}

Spacing

SPACING = {
  xxs: 2, xs: 4, sm: 8, md: 12, lg: 16, xl: 18, xxl: 20, xxxl: 24
}

================================================================================
NAVIGATION (AccountStack.js)
================================================================================

VisionBoard screens in Account tab:
<Stack.Screen name="VisionBoard" component={VisionBoardScreen} />
<Stack.Screen name="Achievements" component={AchievementsScreen} />
<Stack.Screen name="VisionCalendar" component={CalendarScreen} />
<Stack.Screen name="GoalDetail" component={GoalDetailScreen} />
<Stack.Screen name="DailyRecap" component={DailyRecapScreen} />
<Stack.Screen name="RitualPlayground" component={RitualPlaygroundScreen}
  options={{ animation: 'slide_from_bottom', presentation: 'modal' }} />
<Stack.Screen name="RitualHistory" component={RitualHistoryScreen} />

Karma & Shadow Mode screens:
<Stack.Screen name="KarmaDashboard" component={KarmaDashboardScreen} />
<Stack.Screen name="ShadowMode" component={ShadowModeScreen} />
<Stack.Screen name="ConnectBinance" component={ConnectBinanceScreen} />
<Stack.Screen name="ShadowReport" component={ShadowReportScreen} />

================================================================================
TROUBLESHOOTING
================================================================================

Weekly Progress Chart Shows 0%:
1. Check vision_daily_summary table has data
2. Ensure saveDailySummary is called (auto in getFullStats)
3. Check statsService.getWeeklyProgress returns correct data
4. Verify data format: { day_name, total_score, xp_earned }

Manager Still Has Quota Limits:
1. Run supabase/RUN_THIS_fix_manager_quota_FINAL.sql
2. Check profile.role = 'manager' in database
3. Clear quota cache: QuotaService.clearCache()
4. Logout and login again

Chatbot Not Responding:
1. Check EXPO_PUBLIC_GEMINI_API_KEY in environment
2. Verify quota not exceeded (FREE = 5/day)
3. Check network connectivity
4. Review console for API errors

================================================================================
CHANGELOG
================================================================================

| Date       | Version | Changes                                          |
|------------|---------|--------------------------------------------------|
| 2026-01-28 | 2.1.0   | Added Manager role bypass documentation          |
|            |         | Added Weekly Progress Chart fix details          |
|            |         | Added statsService auto-save functionality       |
|            |         | Added full System Prompt documentation           |
|            |         | Added Troubleshooting section                    |
| 2026-01-24 | 2.0.0   | Major update with AI optimization roadmap        |
| 2025-12-15 | 1.5.0   | Added AI Su Phu, Karma System, Shadow Mode       |
| 2025-12-10 | 1.0.0   | Initial Vision Board 2.0 + GemMaster spec        |

================================================================================
END OF DOCUMENT
================================================================================
